<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e50914">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="StreamFlix">
    <meta name="description" content="Watch Movies, Series, K-Drama & Anime - StreamFlix App">
    <title>StreamFlix â€” Watch Movies &amp; Series</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:wght@300;400;500;600;700&family=Barlow+Condensed:wght@700;800&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- Watch Together CSS -->
    <link rel="stylesheet" href="watch-together/watch-together.css">

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS & RESET
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after {
        margin: 0; padding: 0; box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    :root {
        --bg-0: #080808;
        --bg-1: #0f0f0f;
        --bg-2: #161616;
        --bg-3: #1e1e1e;
        --red: #e50914;
        --red-glow: rgba(229,9,20,0.45);
        --red-dark: #b00710;
        --gold: #f5c518;
        --green: #10b981;
        --text-0: #ffffff;
        --text-1: #c8c8c8;
        --text-2: #888888;
        --glass: rgba(255,255,255,0.06);
        --glass-border: rgba(255,255,255,0.10);
        --ease-out: cubic-bezier(0.16,1,0.3,1);
        --ease-in: cubic-bezier(0.7,0,0.84,0);
        --ease-bounce: cubic-bezier(0.34,1.56,0.64,1);
        --row-gap: 14px;
        --section-pad: 0 40px;
        --card-radius: 6px;
        --modal-radius: 14px;
        --nav-h: 64px;
        --bottom-nav-h: 64px;
        --hero-h: 88vh;
    }

    html { scroll-behavior: smooth; }

    body {
        background: var(--bg-0);
        color: var(--text-0);
        font-family: 'Barlow', sans-serif;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        padding-bottom: var(--bottom-nav-h);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCROLLBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: var(--bg-1); }
    ::-webkit-scrollbar-thumb { background: var(--bg-3); border-radius: 4px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NAV
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .nav {
        position: fixed;
        top: 0; left: 0; right: 0;
        height: var(--nav-h);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 40px;
        z-index: 900;
        transition: background 0.4s, backdrop-filter 0.4s;
        background: linear-gradient(180deg, rgba(8,8,8,0.92) 0%, transparent 100%);
    }
    .nav.solid {
        background: rgba(8,8,8,0.97);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .nav-logo {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2.1rem;
        color: var(--red);
        letter-spacing: 2px;
        text-shadow: 0 0 30px var(--red-glow);
        cursor: pointer;
        user-select: none;
        flex-shrink: 0;
    }
    .nav-logo span { font-size: 0.5rem; display: block; letter-spacing: 3px; color: var(--text-2); margin-top: -6px; font-family: 'Barlow', sans-serif; font-weight: 500; text-transform: uppercase; }
    .nav-links {
        display: flex;
        gap: 4px;
        list-style: none;
    }
    .nav-links li a {
        color: var(--text-1);
        text-decoration: none;
        font-size: 0.88rem;
        font-weight: 500;
        padding: 6px 14px;
        border-radius: 4px;
        cursor: pointer;
        transition: color 0.2s, background 0.2s;
        letter-spacing: 0.3px;
        position: relative;
    }
    .nav-links li a::after {
        content: '';
        position: absolute;
        bottom: 2px; left: 14px; right: 14px;
        height: 2px;
        background: var(--red);
        border-radius: 2px;
        transform: scaleX(0);
        transition: transform 0.25s var(--ease-out);
        transform-origin: left;
    }
    .nav-links li a:hover { color: var(--text-0); }
    .nav-links li a:hover::after, .nav-links li a.active::after { transform: scaleX(1); }
    .nav-links li a.active { color: var(--text-0); }

    .nav-right { display: flex; align-items: center; gap: 10px; }

    /* Search */
    .search-wrap {
        display: flex;
        align-items: center;
        gap: 0;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        overflow: hidden;
        transition: border-color 0.3s;
    }
    .search-wrap:focus-within { border-color: var(--red); }
    #searchInput {
        background: transparent;
        border: none;
        outline: none;
        color: var(--text-0);
        font-size: 0.88rem;
        font-family: 'Barlow', sans-serif;
        padding: 8px 14px;
        width: 180px;
        transition: width 0.3s var(--ease-out);
    }
    #searchInput:focus { width: 220px; }
    #searchInput::placeholder { color: var(--text-2); }
    .search-btn-inner {
        background: var(--red);
        border: none;
        color: white;
        padding: 9px 16px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: background 0.2s;
    }
    .search-btn-inner:hover { background: var(--red-dark); }

    .wt-nav-btn {
        display: flex; align-items: center; gap: 6px;
        padding: 8px 16px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        color: var(--text-0);
        font-family: 'Barlow', sans-serif;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s, border-color 0.2s;
        white-space: nowrap;
    }
    .wt-nav-btn:hover { background: var(--red); border-color: var(--red); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HERO ENGINE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero {
        position: relative;
        height: var(--hero-h);
        min-height: 520px;
        overflow: hidden;
        margin-bottom: 0;
    }

    .hero-slide {
        position: absolute;
        inset: 0;
        opacity: 0;
        transition: opacity 1.2s ease;
        pointer-events: none;
    }
    .hero-slide.active { opacity: 1; pointer-events: all; }

    .hero-bg-img {
        position: absolute;
        inset: 0;
        width: 100%; height: 100%;
        object-fit: cover;
        transform: scale(1.06);
        transition: transform 8s ease;
        will-change: transform;
        filter: brightness(0.65);
    }
    .hero-slide.active .hero-bg-img { transform: scale(1.0); }

    .hero-overlay {
        position: absolute;
        inset: 0;
        background:
            linear-gradient(90deg, rgba(8,8,8,0.95) 0%, rgba(8,8,8,0.4) 55%, rgba(8,8,8,0.2) 100%),
            linear-gradient(0deg, rgba(8,8,8,1) 0%, transparent 40%),
            linear-gradient(180deg, rgba(8,8,8,0.6) 0%, transparent 20%);
    }

    .hero-content {
        position: absolute;
        bottom: 120px;
        left: 0;
        padding: 0 40px;
        max-width: 580px;
        z-index: 2;
    }

    .hero-slide.active .hero-badge,
    .hero-slide.active .hero-title,
    .hero-slide.active .hero-desc,
    .hero-slide.active .hero-actions {
        animation: heroReveal 0.9s var(--ease-out) forwards;
    }
    .hero-slide.active .hero-title { animation-delay: 0.1s; }
    .hero-slide.active .hero-desc { animation-delay: 0.2s; }
    .hero-slide.active .hero-actions { animation-delay: 0.3s; }

    @keyframes heroReveal {
        from { opacity: 0; transform: translateY(28px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .hero-badge {
        display: inline-flex; align-items: center; gap: 6px;
        background: var(--red);
        color: white;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 2px;
        text-transform: uppercase;
        padding: 5px 14px;
        border-radius: 3px;
        margin-bottom: 16px;
        opacity: 0;
        position: relative;
        overflow: hidden;
    }
    .hero-badge::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        animation: shimmerBadge 2.5s infinite;
    }
    @keyframes shimmerBadge {
        from { transform: translateX(-100%); }
        to { transform: translateX(100%); }
    }

    .hero-title {
        font-family: 'Barlow Condensed', sans-serif;
        font-size: clamp(2.5rem, 6vw, 4.5rem);
        font-weight: 800;
        line-height: 1.0;
        letter-spacing: -0.5px;
        text-shadow: 0 4px 30px rgba(0,0,0,0.7);
        margin-bottom: 14px;
        opacity: 0;
    }

    .hero-meta {
        display: flex; align-items: center; gap: 12px;
        margin-bottom: 14px;
        font-size: 0.85rem;
        color: var(--text-1);
    }
    .hero-rating {
        background: var(--gold);
        color: #000;
        font-weight: 700;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 0.78rem;
    }

    .hero-desc {
        font-size: 0.95rem;
        line-height: 1.65;
        color: var(--text-1);
        margin-bottom: 28px;
        opacity: 0;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .hero-actions { display: flex; gap: 14px; align-items: center; opacity: 0; flex-wrap: wrap; }

    .btn-hero-play {
        display: inline-flex; align-items: center; gap: 10px;
        padding: 13px 32px;
        background: var(--red);
        color: white;
        border: none;
        border-radius: 5px;
        font-family: 'Barlow', sans-serif;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.2s var(--ease-bounce), box-shadow 0.2s;
        box-shadow: 0 0 0 0 var(--red-glow);
        animation: glow-pulse 2.5s infinite;
    }
    @keyframes glow-pulse {
        0%, 100% { box-shadow: 0 0 0 0 var(--red-glow); }
        50% { box-shadow: 0 0 0 12px transparent; }
    }
    .btn-hero-play:hover { transform: scale(1.04); }
    .btn-hero-play:active { transform: scale(0.97); }

    .btn-hero-more {
        display: inline-flex; align-items: center; gap: 8px;
        padding: 12px 24px;
        background: rgba(255,255,255,0.12);
        color: white;
        border: 1px solid rgba(255,255,255,0.25);
        border-radius: 5px;
        font-family: 'Barlow', sans-serif;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        backdrop-filter: blur(8px);
        transition: background 0.2s;
    }
    .btn-hero-more:hover { background: rgba(255,255,255,0.2); }

    /* Hero dots */
    .hero-dots {
        position: absolute;
        bottom: 80px;
        right: 40px;
        display: flex; gap: 8px;
        z-index: 3;
    }
    .hero-dot {
        width: 6px; height: 6px;
        border-radius: 6px;
        background: rgba(255,255,255,0.3);
        cursor: pointer;
        transition: all 0.3s var(--ease-out);
    }
    .hero-dot.active {
        width: 22px;
        background: var(--red);
    }

    /* Hero progress bar */
    .hero-progress {
        position: absolute;
        bottom: 0; left: 0;
        height: 3px;
        background: var(--red);
        z-index: 3;
        transition: width 0.1s linear;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GENRE FILTER BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .genre-bar {
        position: sticky;
        top: var(--nav-h);
        z-index: 80;
        background: rgba(8,8,8,0.9);
        backdrop-filter: blur(16px);
        border-bottom: 1px solid rgba(255,255,255,0.05);
        overflow: hidden;
    }
    .genre-scroll {
        display: flex;
        gap: 6px;
        padding: 12px 40px;
        overflow-x: auto;
        scrollbar-width: none;
    }
    .genre-scroll::-webkit-scrollbar { display: none; }
    .genre-chip {
        flex-shrink: 0;
        padding: 7px 18px;
        border-radius: 20px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        color: var(--text-1);
        font-family: 'Barlow', sans-serif;
        font-size: 0.82rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
        white-space: nowrap;
    }
    .genre-chip:hover { background: rgba(255,255,255,0.12); color: var(--text-0); }
    .genre-chip.active {
        background: var(--red);
        border-color: var(--red);
        color: white;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTENT ROWS (NETFLIX STYLE)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #mainContent { padding-top: 10px; }

    .content-section { margin-bottom: 36px; }

    .section-header {
        display: flex; align-items: center; justify-content: space-between;
        padding: var(--section-pad);
        margin-bottom: 14px;
    }
    .section-title {
        font-family: 'Barlow Condensed', sans-serif;
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: 0.3px;
        display: flex; align-items: center; gap: 10px;
        position: relative;
    }
    .section-title::before {
        content: '';
        display: inline-block;
        width: 3px; height: 1.1em;
        background: var(--red);
        border-radius: 2px;
        flex-shrink: 0;
    }
    .see-all-btn {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-2);
        cursor: pointer;
        display: flex; align-items: center; gap: 4px;
        transition: color 0.2s;
        white-space: nowrap;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    .see-all-btn:hover { color: var(--red); }
    .see-all-btn::after { content: 'â€º'; font-size: 1.1rem; }

    /* Row wrapper with scroll arrows */
    .row-outer {
        position: relative;
    }
    .row-scroll {
        display: flex;
        gap: var(--row-gap);
        padding: 6px 40px 14px;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
    }
    .row-scroll::-webkit-scrollbar { display: none; }

    /* Edge fade masks */
    .row-outer::before,
    .row-outer::after {
        content: '';
        position: absolute;
        top: 0; bottom: 0;
        width: 60px;
        pointer-events: none;
        z-index: 2;
    }
    .row-outer::before { left: 0; background: linear-gradient(90deg, var(--bg-0), transparent); }
    .row-outer::after { right: 0; background: linear-gradient(270deg, var(--bg-0), transparent); }

    /* Scroll arrows */
    .row-arrow {
        position: absolute;
        top: 50%; transform: translateY(-50%);
        z-index: 3;
        width: 40px; height: 40px;
        border-radius: 50%;
        background: rgba(20,20,20,0.92);
        border: 1px solid rgba(255,255,255,0.15);
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        opacity: 0;
        transition: opacity 0.2s, background 0.2s;
        backdrop-filter: blur(8px);
    }
    .row-outer:hover .row-arrow { opacity: 1; }
    .row-arrow:hover { background: var(--red); }
    .row-arrow.left { left: 6px; }
    .row-arrow.right { right: 6px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CARDS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .content-card {
        flex-shrink: 0;
        width: 155px;
        border-radius: var(--card-radius);
        overflow: hidden;
        background: var(--bg-2);
        cursor: pointer;
        scroll-snap-align: start;
        position: relative;
        transition: transform 0.35s var(--ease-out), box-shadow 0.35s var(--ease-out), z-index 0s 0.35s;
        will-change: transform;
        animation: cardIn 0.5s var(--ease-out) both;
    }
    @keyframes cardIn {
        from { opacity: 0; transform: translateY(16px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .content-card:hover {
        transform: scale(1.1) translateY(-4px);
        box-shadow: 0 20px 50px rgba(0,0,0,0.7);
        z-index: 10;
        transition: transform 0.35s var(--ease-out), box-shadow 0.35s var(--ease-out), z-index 0s;
    }
    .content-card:active { transform: scale(0.96); }

    .card-img-wrap {
        aspect-ratio: 2/3;
        overflow: hidden;
        position: relative;
    }
    .card-img {
        width: 100%; height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.4s var(--ease-out), filter 0.3s;
    }
    .content-card:hover .card-img {
        transform: scale(1.05);
        filter: brightness(0.7);
    }

    /* Shimmer placeholder */
    .card-shimmer {
        width: 100%; height: 100%;
        background: linear-gradient(110deg, var(--bg-2) 30%, var(--bg-3) 50%, var(--bg-2) 70%);
        background-size: 300% 100%;
        animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer {
        0% { background-position: 100% 0; }
        100% { background-position: -100% 0; }
    }

    .card-play-icon {
        position: absolute;
        inset: 0;
        display: flex; align-items: center; justify-content: center;
        font-size: 2.5rem;
        opacity: 0;
        transition: opacity 0.3s;
        background: rgba(0,0,0,0.25);
    }
    .content-card:hover .card-play-icon { opacity: 1; }

    /* Badges */
    .card-badge-type {
        position: absolute;
        top: 7px; right: 7px;
        background: var(--red);
        color: white;
        font-size: 0.6rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        padding: 2px 6px;
        border-radius: 3px;
    }
    .card-badge-mature {
        position: absolute;
        top: 7px; left: 7px;
        background: #1a1a1a;
        border: 1px solid #555;
        color: #ccc;
        font-size: 0.6rem;
        font-weight: 700;
        padding: 2px 6px;
        border-radius: 3px;
    }
    .card-badge-sub {
        position: absolute;
        bottom: 44px; left: 7px;
        background: var(--green);
        color: white;
        font-size: 0.58rem;
        font-weight: 700;
        padding: 2px 5px;
        border-radius: 3px;
    }

    .card-overlay {
        padding: 10px;
        background: linear-gradient(0deg, rgba(0,0,0,0.95) 0%, transparent 100%);
        position: absolute;
        bottom: 0; left: 0; right: 0;
    }
    .card-title {
        font-size: 0.8rem;
        font-weight: 600;
        line-height: 1.25;
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .card-meta-row {
        display: flex; gap: 8px;
        font-size: 0.68rem;
        color: var(--text-2);
    }
    .card-meta-row .star { color: var(--gold); }

    /* 18+ BLUR OVERLAY */
    .card-mature-lock {
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.55);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        transition: backdrop-filter 0.3s;
    }
    .card-mature-lock .lock-icon { font-size: 2rem; }
    .card-mature-lock .lock-text { font-size: 0.7rem; font-weight: 600; color: var(--text-1); text-align: center; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEARCH INFO + RESULTS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .search-info {
        padding: calc(var(--nav-h) + 20px) 40px 20px;
        display: none;
    }
    .search-info.active { display: block; }
    .search-info h2 { font-family: 'Barlow Condensed', sans-serif; font-size: 1.8rem; font-weight: 700; }
    .search-info p { color: var(--text-2); font-size: 0.9rem; margin-top: 4px; }

    #searchResultsContainer { display: none; }
    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 14px;
        padding: var(--section-pad);
        padding-bottom: 20px;
    }
    .results-grid .content-card { width: 100%; }

    /* Pagination */
    .pagination {
        display: flex; justify-content: center; flex-wrap: wrap; gap: 6px;
        padding: 16px 40px 30px;
    }
    .page-btn {
        padding: 8px 16px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 5px;
        color: var(--text-1);
        font-family: 'Barlow', sans-serif;
        font-size: 0.82rem;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
    }
    .page-btn.active, .page-btn:hover { background: var(--red); border-color: var(--red); color: white; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOTTOM NAV (MOBILE ONLY)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bottom-nav {
        display: none;
        position: fixed;
        bottom: 0; left: 0; right: 0;
        height: var(--bottom-nav-h);
        background: rgba(8,8,8,0.97);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255,255,255,0.07);
        z-index: 800;
        justify-content: space-around;
        align-items: center;
        padding: 0 8px;
    }
    .bn-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3px;
        padding: 10px 14px;
        cursor: pointer;
        color: var(--text-2);
        transition: color 0.2s;
        flex: 1;
    }
    .bn-item.active { color: var(--red); }
    .bn-item:hover { color: var(--text-0); }
    .bn-icon { font-size: 1.25rem; line-height: 1; }
    .bn-label { font-size: 0.6rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; }
    .bn-search-toggle {
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3px;
        padding: 10px 14px;
        flex: 1;
        font-family: 'Barlow', sans-serif;
        color: var(--text-2);
        transition: color 0.2s;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE SEARCH OVERLAY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .mobile-search-overlay {
        display: none;
        position: fixed;
        top: 0; inset: 0;
        background: rgba(8,8,8,0.97);
        z-index: 950;
        flex-direction: column;
        padding: 20px;
    }
    .mobile-search-overlay.open { display: flex; }
    .mobile-search-header {
        display: flex; gap: 12px; align-items: center;
        margin-bottom: 20px;
    }
    .mobile-search-input {
        flex: 1;
        background: var(--bg-2);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
        color: var(--text-0);
        font-family: 'Barlow', sans-serif;
        font-size: 1rem;
        padding: 14px 18px;
        outline: none;
    }
    .mobile-search-input:focus { border-color: var(--red); }
    .mobile-cancel-btn {
        background: none;
        border: none;
        color: var(--red);
        font-family: 'Barlow', sans-serif;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       18+ VERIFICATION MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .overlay-backdrop {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.85);
        backdrop-filter: blur(12px);
        z-index: 2500;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        animation: fadeIn 0.3s forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }

    .verify-modal {
        background: var(--bg-2);
        border: 1px solid var(--glass-border);
        border-radius: var(--modal-radius);
        padding: 40px;
        max-width: 440px;
        width: 100%;
        text-align: center;
        box-shadow: 0 40px 80px rgba(0,0,0,0.8);
        transform: translateY(20px);
        animation: modalUp 0.35s var(--ease-out) forwards;
    }
    @keyframes modalUp { to { transform: translateY(0); } }

    .verify-icon { font-size: 3.5rem; margin-bottom: 20px; }
    .verify-title {
        font-family: 'Barlow Condensed', sans-serif;
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    .verify-subtitle { color: var(--text-2); font-size: 0.9rem; line-height: 1.55; margin-bottom: 28px; }

    .verify-step { display: none; }
    .verify-step.active { display: block; }

    .verify-actions { display: flex; flex-direction: column; gap: 10px; }

    .btn-verify-confirm {
        width: 100%;
        padding: 14px;
        background: var(--red);
        color: white;
        border: none;
        border-radius: 8px;
        font-family: 'Barlow', sans-serif;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: background 0.2s, transform 0.15s;
    }
    .btn-verify-confirm:hover { background: var(--red-dark); }
    .btn-verify-confirm:active { transform: scale(0.98); }

    .btn-verify-cancel {
        width: 100%;
        padding: 12px;
        background: transparent;
        color: var(--text-2);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
        font-family: 'Barlow', sans-serif;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    .btn-verify-cancel:hover { border-color: var(--text-2); color: var(--text-1); }

    .btn-switch-method {
        background: none;
        border: none;
        color: var(--red);
        font-family: 'Barlow', sans-serif;
        font-size: 0.85rem;
        cursor: pointer;
        padding: 4px;
        text-decoration: underline;
    }

    /* PIN Input */
    .pin-row {
        display: flex; gap: 12px; justify-content: center;
        margin: 24px 0;
    }
    .pin-digit {
        width: 54px; height: 64px;
        background: var(--bg-3);
        border: 2px solid var(--glass-border);
        border-radius: 8px;
        color: var(--text-0);
        font-size: 1.6rem;
        font-weight: 700;
        text-align: center;
        outline: none;
        transition: border-color 0.2s;
        font-family: 'Barlow', sans-serif;
        caret-color: var(--red);
    }
    .pin-digit:focus { border-color: var(--red); }

    .pin-error {
        color: var(--red);
        font-size: 0.82rem;
        margin-top: -8px;
        margin-bottom: 10px;
        min-height: 20px;
    }

    .lockout-timer {
        color: var(--red);
        font-size: 0.85rem;
        margin: 8px 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PLAYER MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .player-modal {
        display: none;
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.98);
        z-index: 2000;
        flex-direction: column;
    }
    .player-modal.active { display: flex; }

    .player-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 20px;
        background: var(--bg-1);
        border-bottom: 2px solid var(--red);
        flex-shrink: 0;
    }
    .player-title {
        font-family: 'Barlow Condensed', sans-serif;
        font-size: 1.2rem;
        font-weight: 700;
        flex: 1;
        letter-spacing: 0.3px;
    }
    .close-player {
        background: none;
        border: none;
        color: var(--text-1);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 4px 8px;
        transition: color 0.2s;
    }
    .close-player:hover { color: white; }

    .player-video {
        flex: 1;
        background: #000;
        position: relative;
        min-height: 0;
    }
    .player-video iframe { width: 100%; height: 100%; border: none; }

    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        flex-direction: column;
        gap: 16px;
        color: var(--text-2);
    }
    .spinner {
        width: 42px; height: 42px;
        border: 3px solid rgba(255,255,255,0.08);
        border-top-color: var(--red);
        border-radius: 50%;
        animation: spin 0.9s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .server-selector {
        padding: 14px 20px;
        background: var(--bg-1);
        max-height: 180px;
        overflow-y: auto;
        flex-shrink: 0;
    }
    .server-label { font-size: 0.8rem; color: var(--text-2); margin-bottom: 8px; }
    .server-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 7px; }
    .server-btn {
        padding: 9px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 5px;
        color: var(--text-1);
        font-family: 'Barlow', sans-serif;
        font-size: 0.82rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
    }
    .server-btn:hover { background: rgba(255,255,255,0.12); color: white; }
    .server-btn.active { background: var(--red); border-color: var(--red); color: white; }
    .sub-badge {
        display: inline-block;
        background: var(--green);
        color: white;
        padding: 1px 4px;
        border-radius: 3px;
        font-size: 0.58rem;
        margin-left: 3px;
        font-weight: 700;
    }
    .subtitle-tip {
        margin-top: 10px;
        padding: 10px;
        background: rgba(16,185,129,0.1);
        border-left: 3px solid var(--green);
        border-radius: 4px;
        font-size: 0.82rem;
        color: var(--text-2);
    }
    .subtitle-tip strong { color: var(--green); }

    /* Watch Together in player */
    .wt-player-btn {
        display: flex; align-items: center; gap: 6px;
        padding: 7px 14px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        color: var(--text-0);
        font-family: 'Barlow', sans-serif;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    .wt-player-btn:hover { background: var(--red); border-color: var(--red); }

    /* Room indicator */
    .room-indicator {
        display: none;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--red);
    }
    .room-indicator.show { display: flex; }
    .live-dot { animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    /* Chat panel */
    .chat-panel { display: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INSTALL BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .install-banner {
        position: fixed;
        bottom: var(--bottom-nav-h);
        left: 0; right: 0;
        background: linear-gradient(to right, #b00710, var(--red));
        padding: 14px 20px;
        display: none;
        align-items: center;
        justify-content: space-between;
        z-index: 790;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
        animation: slideUp 0.3s var(--ease-out);
    }
    .install-banner.show { display: flex; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .install-content { flex: 1; }
    .install-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 3px; }
    .install-text { font-size: 0.78rem; opacity: 0.85; }
    .install-btn {
        padding: 9px 22px;
        background: white;
        color: var(--red);
        border: none;
        border-radius: 20px;
        font-weight: 700;
        cursor: pointer;
        font-size: 0.85rem;
        transition: transform 0.2s;
    }
    .install-btn:hover { transform: scale(1.04); }
    .close-banner {
        background: none; border: none; color: white;
        font-size: 1.4rem; cursor: pointer; padding: 0 10px; margin-left: 12px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GLASS MODAL (WatchTogether overrides)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .wt-modal {
        display: none;
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.75);
        backdrop-filter: blur(12px);
        z-index: 3000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    .wt-modal.open { display: flex; }
    .wt-modal-content {
        background: var(--bg-2);
        border: 1px solid var(--glass-border);
        border-radius: var(--modal-radius);
        max-width: 460px;
        width: 100%;
        box-shadow: 0 40px 80px rgba(0,0,0,0.7);
        overflow: hidden;
    }
    .wt-modal-content.small { max-width: 360px; }
    .wt-modal-header {
        display: flex; align-items: center; justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid var(--glass-border);
    }
    .wt-modal-header h2 { font-family: 'Barlow Condensed', sans-serif; font-size: 1.4rem; font-weight: 700; }
    .btn-close-modal {
        background: none; border: none; color: var(--text-2);
        font-size: 1.3rem; cursor: pointer; transition: color 0.2s;
    }
    .btn-close-modal:hover { color: white; }
    .wt-modal-body { padding: 24px; }

    /* Section reveal animation */
    .content-section {
        opacity: 0;
        transform: translateY(24px);
        transition: opacity 0.6s var(--ease-out), transform 0.6s var(--ease-out);
    }
    .content-section.visible { opacity: 1; transform: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FILTER BAR (Advanced filters - collapsible)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .advanced-filters {
        padding: 0 40px 12px;
        display: none;
        gap: 10px;
        flex-wrap: wrap;
    }
    .advanced-filters.show { display: flex; }
    .filter-select {
        padding: 7px 14px;
        background: var(--bg-2);
        border: 1px solid var(--glass-border);
        border-radius: 6px;
        color: var(--text-1);
        font-family: 'Barlow', sans-serif;
        font-size: 0.82rem;
        cursor: pointer;
        outline: none;
    }
    .filter-select:focus { border-color: var(--red); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TYPOGRAPHY ACCENTS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .highlight { color: var(--red); }
    .tag-pill {
        display: inline-block;
        background: var(--bg-3);
        border-radius: 20px;
        padding: 3px 10px;
        font-size: 0.72rem;
        color: var(--text-2);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (min-width: 769px) {
        .bottom-nav { display: none !important; }
        body { padding-bottom: 0; }
    }

    @media (max-width: 768px) {
        :root {
            --hero-h: 62vh;
            --section-pad: 0 16px;
        }
        .nav { padding: 0 16px; }
        .nav-links { display: none; }
        .nav-right .search-wrap { display: none; }
        .wt-nav-btn { display: none; }
        .nav-logo { font-size: 1.7rem; }
        .bottom-nav { display: flex; }
        .hero-content { padding: 0 16px; bottom: 90px; }
        .hero-dots { bottom: 70px; right: 16px; }
        .genre-scroll { padding: 10px 16px; }
        .row-scroll { padding: 6px 16px 14px; }
        .row-outer::before, .row-outer::after { width: 20px; }
        .row-arrow { display: none; }
        .section-header { padding: 0 16px; }
        .search-info { padding: calc(var(--nav-h) + 10px) 16px 10px; }
        .results-grid { padding: 0 16px; }
        .pagination { padding: 12px 16px 20px; }
        .advanced-filters { padding: 0 16px 12px; }
        .server-grid { grid-template-columns: repeat(auto-fill, minmax(90px,1fr)); }
        .content-card { width: 130px; }
    }

    @media (max-width: 480px) {
        .content-card { width: 115px; }
        .hero-title { font-size: 1.9rem; }
    }
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INSTALL BANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="install-banner" id="installBanner">
    <div class="install-content">
        <div class="install-title">ğŸ“± Install StreamFlix</div>
        <div class="install-text">Add to home screen for the best experience</div>
    </div>
    <button class="install-btn" id="installBtn">Install</button>
    <button class="close-banner" id="closeBanner">&times;</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="nav" id="navbar">
    <div class="nav-logo" onclick="SF.goHome()">
        STREAMFLIX
        <span>by Mr.Yoh_amari</span>
    </div>

    <ul class="nav-links" id="navLinks">
        <li><a onclick="SF.loadCategory('trending')" data-cat="trending">Trending</a></li>
        <li><a onclick="SF.loadCategory('movies')" data-cat="movies">Movies</a></li>
        <li><a onclick="SF.loadCategory('tv')" data-cat="tv">TV Series</a></li>
        <li><a onclick="SF.loadCategory('kdrama')" data-cat="kdrama">K-Drama</a></li>
        <li><a onclick="SF.loadCategory('anime')" data-cat="anime">Anime</a></li>
        <li><a onclick="SF.openMature()" data-cat="mature" style="color:#e50914">ğŸ” 18+</a></li>
    </ul>

    <div class="nav-right">
        <button class="wt-nav-btn" onclick="showWatchTogetherMenu()">
            <span>ğŸ‘¥</span> Watch Together
        </button>
        <div class="search-wrap">
            <input type="text" id="searchInput" placeholder="Search movies, series..." autocomplete="off">
            <button class="search-btn-inner" onclick="SF.performSearch()">ğŸ”</button>
        </div>
    </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HERO ENGINE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="hero" id="hero">
    <!-- Slides injected by JS -->
    <div class="hero-progress" id="heroProgress" style="width:0%"></div>
    <div class="hero-dots" id="heroDots"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GENRE BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="genre-bar" id="genreBar">
    <div class="genre-scroll" id="genreScroll">
        <div class="genre-chip active" data-genre="all" onclick="SF.filterGenre(this)">All</div>
        <div class="genre-chip" data-genre="Action" onclick="SF.filterGenre(this)">Action</div>
        <div class="genre-chip" data-genre="Drama" onclick="SF.filterGenre(this)">Drama</div>
        <div class="genre-chip" data-genre="Comedy" onclick="SF.filterGenre(this)">Comedy</div>
        <div class="genre-chip" data-genre="Thriller" onclick="SF.filterGenre(this)">Thriller</div>
        <div class="genre-chip" data-genre="Romance" onclick="SF.filterGenre(this)">Romance</div>
        <div class="genre-chip" data-genre="Sci-Fi" onclick="SF.filterGenre(this)">Sci-Fi</div>
        <div class="genre-chip" data-genre="Horror" onclick="SF.filterGenre(this)">Horror</div>
        <div class="genre-chip" data-genre="Fantasy" onclick="SF.filterGenre(this)">Fantasy</div>
        <div class="genre-chip" data-genre="Animation" onclick="SF.filterGenre(this)">Animation</div>
        <div class="genre-chip" data-genre="Documentary" onclick="SF.filterGenre(this)">Documentary</div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADVANCED FILTERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="advanced-filters" id="advancedFilters">
    <select class="filter-select" id="filterRating" onchange="SF.applyFilters()">
        <option value="">Rating</option>
        <option value="G">G</option>
        <option value="PG">PG</option>
        <option value="PG-13">PG-13</option>
        <option value="R">R</option>
        <option value="18+">18+</option>
    </select>
    <select class="filter-select" id="filterYear" onchange="SF.applyFilters()">
        <option value="">Year</option>
        <option value="2024">2024</option>
        <option value="2023">2023</option>
        <option value="2022">2022</option>
        <option value="2021">2021</option>
        <option value="2020">2020</option>
        <option value="2019">2019</option>
    </select>
    <select class="filter-select" id="filterLang" onchange="SF.applyFilters()">
        <option value="">Language</option>
        <option value="en">English</option>
        <option value="ko">Korean</option>
        <option value="ja">Japanese</option>
        <option value="zh">Chinese</option>
        <option value="es">Spanish</option>
    </select>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SEARCH INFO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="search-info" id="searchInfo">
    <h2 id="searchTitle"></h2>
    <p id="searchCount"></p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN CONTENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mainContent">
    <section class="content-section" id="section-trending">
        <div class="section-header">
            <h2 class="section-title">ğŸ”¥ Trending Now</h2>
            <div class="see-all-btn" onclick="SF.seeAll('trending')">See All</div>
        </div>
        <div class="row-outer" id="row-trending">
            <button class="row-arrow left" onclick="SF.scrollRow('trending',-1)" aria-label="Scroll left">â€¹</button>
            <div class="row-scroll" id="trendingContent"></div>
            <button class="row-arrow right" onclick="SF.scrollRow('trending',1)" aria-label="Scroll right">â€º</button>
        </div>
    </section>

    <section class="content-section" id="section-movies">
        <div class="section-header">
            <h2 class="section-title">ğŸ¬ Popular Movies</h2>
            <div class="see-all-btn" onclick="SF.seeAll('movies')">See All</div>
        </div>
        <div class="row-outer" id="row-movies">
            <button class="row-arrow left" onclick="SF.scrollRow('movies',-1)" aria-label="Scroll left">â€¹</button>
            <div class="row-scroll" id="moviesContent"></div>
            <button class="row-arrow right" onclick="SF.scrollRow('movies',1)" aria-label="Scroll right">â€º</button>
        </div>
    </section>

    <section class="content-section" id="section-tv">
        <div class="section-header">
            <h2 class="section-title">ğŸ“º TV Series</h2>
            <div class="see-all-btn" onclick="SF.seeAll('tv')">See All</div>
        </div>
        <div class="row-outer" id="row-tv">
            <button class="row-arrow left" onclick="SF.scrollRow('tv',-1)" aria-label="Scroll left">â€¹</button>
            <div class="row-scroll" id="tvContent"></div>
            <button class="row-arrow right" onclick="SF.scrollRow('tv',1)" aria-label="Scroll right">â€º</button>
        </div>
    </section>

    <section class="content-section" id="section-kdrama">
        <div class="section-header">
            <h2 class="section-title">ğŸ‡°ğŸ‡· K-Drama</h2>
            <div class="see-all-btn" onclick="SF.seeAll('kdrama')">See All</div>
        </div>
        <div class="row-outer" id="row-kdrama">
            <button class="row-arrow left" onclick="SF.scrollRow('kdrama',-1)" aria-label="Scroll left">â€¹</button>
            <div class="row-scroll" id="kdramaContent"></div>
            <button class="row-arrow right" onclick="SF.scrollRow('kdrama',1)" aria-label="Scroll right">â€º</button>
        </div>
    </section>

    <section class="content-section" id="section-anime">
        <div class="section-header">
            <h2 class="section-title">ğŸŒ Anime</h2>
            <div class="see-all-btn" onclick="SF.seeAll('anime')">See All</div>
        </div>
        <div class="row-outer" id="row-anime">
            <button class="row-arrow left" onclick="SF.scrollRow('anime',-1)" aria-label="Scroll left">â€¹</button>
            <div class="row-scroll" id="animeContent"></div>
            <button class="row-arrow right" onclick="SF.scrollRow('anime',1)" aria-label="Scroll right">â€º</button>
        </div>
    </section>

    <section class="content-section" id="section-mature" style="display:none;">
        <div class="section-header">
            <h2 class="section-title" style="color:#e50914;">ğŸ” 18+ Mature</h2>
            <div class="see-all-btn" onclick="SF.seeAll('mature')">See All</div>
        </div>
        <div class="row-outer" id="row-mature">
            <button class="row-arrow left" onclick="SF.scrollRow('mature',-1)" aria-label="Scroll left">â€¹</button>
            <div class="row-scroll" id="matureContent"></div>
            <button class="row-arrow right" onclick="SF.scrollRow('mature',1)" aria-label="Scroll right">â€º</button>
        </div>
    </section>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SEARCH RESULTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="searchResultsContainer">
    <div class="results-grid" id="searchResultsContent"></div>
    <div class="pagination" id="pagination"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLAYER MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="player-modal" id="playerModal">
    <div style="display:flex;flex-direction:column;height:100%;">
        <div class="player-header">
            <div class="player-title" id="playerTitle">StreamFlix Player</div>
            <div class="room-indicator" id="roomIndicator">
                <span class="live-dot">ğŸ”´</span>
                <span>LIVE: <span id="roomCodeBadge">ABC123</span></span>
            </div>
            <button class="wt-player-btn" onclick="showWatchTogetherMenu()" id="playerWatchBtn">
                <span>ğŸ‘¥</span> Watch Together
            </button>
            <button class="btn-toggle-chat" id="toggleChatBtn" onclick="toggleChatPanel()" style="display:none;background:none;border:none;color:white;cursor:pointer;font-size:1.2rem;padding:4px 8px;position:relative;">
                ğŸ’¬ <span class="chat-badge" id="chatBadge" style="position:absolute;top:0;right:0;background:var(--red);color:white;font-size:0.6rem;border-radius:50%;padding:1px 4px;">0</span>
            </button>
            <button class="close-player" onclick="SF.closePlayer()">âœ•</button>
        </div>

        <div class="player-video" id="playerVideo">
            <div class="loading"><div class="spinner"></div><span>Loading player...</span></div>
        </div>

        <!-- Chat Panel -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header" style="padding:10px 16px;border-bottom:1px solid rgba(255,255,255,0.08);display:flex;justify-content:space-between;align-items:center;">
                <h3>ğŸ’¬ Chat</h3>
                <div class="participants-info" style="font-size:0.8rem;color:var(--text-2);">
                    <span id="participantCount">0</span> watching
                </div>
            </div>
            <div class="participants-list" id="participantsList"></div>
            <div class="chat-messages" id="chatMessages" style="flex:1;overflow-y:auto;padding:10px 16px;"></div>
            <div class="chat-input-container" style="display:flex;gap:8px;padding:10px 16px;border-top:1px solid rgba(255,255,255,0.08);">
                <input type="text" id="chatInput" class="chat-input" placeholder="Type a message..." maxlength="200"
                    style="flex:1;background:var(--bg-2);border:1px solid var(--glass-border);border-radius:6px;color:white;font-family:'Barlow',sans-serif;font-size:0.88rem;padding:8px 12px;outline:none;">
                <span class="char-counter" id="charCounter" style="font-size:0.7rem;color:var(--text-2);align-self:center;">200</span>
                <button class="btn-send-chat" id="sendChatBtn" style="background:var(--red);border:none;border-radius:6px;color:white;padding:8px 12px;cursor:pointer;">ğŸ“¨</button>
            </div>
            <div class="room-controls" style="padding:8px 16px;">
                <button class="wt-btn danger small" onclick="leaveRoom()"
                    style="background:rgba(229,9,20,0.2);border:1px solid var(--red);color:var(--red);border-radius:6px;padding:6px 14px;cursor:pointer;font-family:'Barlow',sans-serif;font-size:0.82rem;">Leave Room</button>
            </div>
        </div>

        <div class="sync-indicator" style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.7);color:white;padding:8px 16px;border-radius:6px;font-size:0.85rem;">Syncing...</div>

        <div class="server-selector">
            <div class="server-label">Select Server:</div>
            <div class="server-grid" id="serverButtons"></div>
            <div class="subtitle-tip">ğŸ’¡ <strong>Tip:</strong> Most servers have built-in English subtitles. Look for the CC button in video controls.</div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 18+ VERIFY MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay-backdrop" id="verifyModal" style="display:none;">
    <div class="verify-modal">
        <div class="verify-icon">ğŸ”</div>
        <div class="verify-title">Restricted Content</div>

        <!-- Step 1: Age Confirm -->
        <div class="verify-step active" id="verifyStep1">
            <p class="verify-subtitle">
                This section contains mature content intended for adults only.
                You must confirm you are 18 years or older to continue.
            </p>
            <div class="verify-actions">
                <button class="btn-verify-confirm" onclick="SF.verifyAge()">âœ” I confirm I am 18+</button>
                <button class="btn-switch-method" onclick="SF.showPinStep()">Enter Parental PIN instead</button>
                <button class="btn-verify-cancel" onclick="SF.closeVerify()">Cancel</button>
            </div>
        </div>

        <!-- Step 2: PIN -->
        <div class="verify-step" id="verifyStep2">
            <p class="verify-subtitle">Enter your 4-digit parental PIN</p>
            <div class="pin-row" id="pinRow">
                <input class="pin-digit" type="password" inputmode="numeric" maxlength="1" data-idx="0">
                <input class="pin-digit" type="password" inputmode="numeric" maxlength="1" data-idx="1">
                <input class="pin-digit" type="password" inputmode="numeric" maxlength="1" data-idx="2">
                <input class="pin-digit" type="password" inputmode="numeric" maxlength="1" data-idx="3">
            </div>
            <div class="pin-error" id="pinError"></div>
            <div class="lockout-timer" id="lockoutTimer"></div>
            <div class="verify-actions">
                <button class="btn-verify-confirm" onclick="SF.verifyPin()">Unlock</button>
                <button class="btn-switch-method" onclick="SF.showAgeStep()">â† Back</button>
                <button class="btn-verify-cancel" onclick="SF.closeVerify()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV (MOBILE) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="bottom-nav" id="bottomNav">
    <div class="bn-item active" id="bn-home" onclick="SF.goHome(); SF.setBnActive('home')">
        <div class="bn-icon">ğŸ </div>
        <div class="bn-label">Home</div>
    </div>
    <div class="bn-item" id="bn-categories" onclick="SF.showCategories(); SF.setBnActive('categories')">
        <div class="bn-icon">ğŸ“‚</div>
        <div class="bn-label">Categories</div>
    </div>
    <button class="bn-search-toggle" id="bn-search" onclick="SF.toggleMobileSearch(); SF.setBnActive('search')">
        <div class="bn-icon">ğŸ”</div>
        <div class="bn-label" style="font-size:0.6rem;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;">Search</div>
    </button>
    <div class="bn-item" id="bn-together" onclick="showWatchTogetherMenu(); SF.setBnActive('together')">
        <div class="bn-icon">ğŸ‘¥</div>
        <div class="bn-label">Together</div>
    </div>
    <div class="bn-item" id="bn-settings" onclick="SF.openSettings(); SF.setBnActive('settings')">
        <div class="bn-icon">âš™ï¸</div>
        <div class="bn-label">Settings</div>
    </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MOBILE SEARCH OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="mobile-search-overlay" id="mobileSearchOverlay">
    <div class="mobile-search-header">
        <input class="mobile-search-input" id="mobileSearchInput" type="text" placeholder="Search movies, shows...">
        <button class="mobile-cancel-btn" onclick="SF.closeMobileSearch()">Cancel</button>
    </div>
    <div id="mobileSearchResults"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WATCH TOGETHER MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="wt-modal" id="watchTogetherMenu">
    <div class="wt-modal-content">
        <div class="wt-modal-header">
            <h2>ğŸ‘¥ Watch Together</h2>
            <button class="btn-close-modal" onclick="closeWatchTogetherMenu()">âœ•</button>
        </div>
        <div class="wt-modal-body">
            <div style="display:flex;flex-direction:column;gap:12px;">
                <button onclick="initCreateRoom()" style="display:flex;align-items:center;gap:14px;padding:18px;background:var(--bg-3);border:1px solid var(--glass-border);border-radius:10px;color:white;font-family:'Barlow',sans-serif;cursor:pointer;text-align:left;transition:background 0.2s;" onmouseover="this.style.background='rgba(229,9,20,0.15)'" onmouseout="this.style.background='var(--bg-3)'">
                    <span style="font-size:2rem;">ğŸ¬</span>
                    <div>
                        <div style="font-weight:700;font-size:1rem;margin-bottom:3px;">Create Room</div>
                        <div style="font-size:0.82rem;color:var(--text-2);">Start watching with friends</div>
                    </div>
                </button>
                <button onclick="showJoinRoomDialog()" style="display:flex;align-items:center;gap:14px;padding:18px;background:var(--bg-3);border:1px solid var(--glass-border);border-radius:10px;color:white;font-family:'Barlow',sans-serif;cursor:pointer;text-align:left;transition:background 0.2s;" onmouseover="this.style.background='rgba(229,9,20,0.15)'" onmouseout="this.style.background='var(--bg-3)'">
                    <span style="font-size:2rem;">ğŸ”—</span>
                    <div>
                        <div style="font-weight:700;font-size:1rem;margin-bottom:3px;">Join Room</div>
                        <div style="font-size:0.82rem;color:var(--text-2);">Enter room code to join</div>
                    </div>
                </button>
            </div>
        </div>
    </div>
</div>

<div class="wt-modal" id="joinRoomModal">
    <div class="wt-modal-content small">
        <div class="wt-modal-header">
            <h2>Join Watch Room</h2>
            <button class="btn-close-modal" onclick="closeJoinRoomDialog()">âœ•</button>
        </div>
        <div class="wt-modal-body">
            <input type="text" id="joinRoomCodeInput" class="wt-input"
                placeholder="Enter 6-character code" maxlength="6" style="text-transform:uppercase;width:100%;padding:12px 16px;background:var(--bg-3);border:1px solid var(--glass-border);border-radius:8px;color:white;font-family:'Barlow',sans-serif;font-size:1rem;outline:none;margin-bottom:14px;">
            <button onclick="handleJoinRoom()" style="width:100%;padding:13px;background:var(--red);color:white;border:none;border-radius:8px;font-family:'Barlow',sans-serif;font-size:1rem;font-weight:700;cursor:pointer;">Join Room</button>
        </div>
    </div>
</div>

<div class="wt-modal" id="roomCreatedModal">
    <div class="wt-modal-content">
        <div class="wt-modal-header">
            <h2>ğŸ‰ Room Created!</h2>
            <button class="btn-close-modal" onclick="closeRoomCreatedModal()">âœ•</button>
        </div>
        <div class="wt-modal-body">
            <div style="margin-bottom:16px;">
                <label style="font-size:0.8rem;color:var(--text-2);display:block;margin-bottom:8px;">Room Code</label>
                <div id="roomCodeDisplay" style="background:var(--bg-3);border:1px solid var(--glass-border);border-radius:8px;padding:16px;text-align:center;font-size:2rem;font-weight:700;letter-spacing:6px;font-family:'Barlow Condensed',sans-serif;color:var(--red);">ABC123</div>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-size:0.8rem;color:var(--text-2);display:block;margin-bottom:8px;">Invite Link</label>
                <div style="display:flex;gap:8px;">
                    <input type="text" id="inviteLinkDisplay" readonly style="flex:1;background:var(--bg-3);border:1px solid var(--glass-border);border-radius:6px;color:var(--text-1);font-family:'Barlow',sans-serif;font-size:0.82rem;padding:9px 12px;outline:none;">
                    <button onclick="copyInviteLink()" style="padding:9px 14px;background:var(--glass);border:1px solid var(--glass-border);border-radius:6px;color:white;cursor:pointer;font-size:0.82rem;white-space:nowrap;">ğŸ“‹ Copy</button>
                </div>
            </div>
            <div style="display:flex;gap:10px;">
                <button onclick="shareRoom()" style="flex:1;padding:12px;background:var(--glass);border:1px solid var(--glass-border);border-radius:8px;color:white;font-family:'Barlow',sans-serif;font-size:0.9rem;cursor:pointer;">ğŸ“¤ Share</button>
                <button onclick="closeRoomCreatedModal()" style="flex:1;padding:12px;background:var(--red);border:none;border-radius:8px;color:white;font-family:'Barlow',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;">Start Watching</button>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="app.js"></script>
<script src="watch-together/firebase-config.js"></script>
<script src="watch-together/room-manager.js"></script>
<script src="watch-together/sync-engine.js"></script>
<script src="watch-together/chat-system.js"></script>
<script src="watch-together/ui-components.js"></script>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STREAMFLIX 3.0 â€” CORE ENGINE
   Modular state-driven architecture
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const SF = (() => {

/* â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const state = {
    currentCategory: 'home',
    currentGenre: 'all',
    searchQuery: '',
    filters: { rating: '', year: '', lang: '' },
    matureUnlocked: false,
    matureSessionExpiry: 0,
    pinHash: null,
    pinFailCount: 0,
    pinLockoutUntil: 0,
    currentContent: {},
    heroSlides: [],
    heroIndex: 0,
    heroTimer: null,
    heroProgressTimer: null,
    heroProgressVal: 0,
    HERO_INTERVAL: 7000,
    searchPage: 1,
    searchTotalPages: 1,
    cache: {},
    observers: [],
};

const MATURE_SESSION_MS = 15 * 60 * 1000; // 15 min
const PIN_MAX_ATTEMPTS = 5;
const PIN_LOCKOUT_MS = 5 * 60 * 1000; // 5 min

/* â”€â”€ HERO ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const HERO_DATA = [
    { id: '872585', type: 'movie', title: 'Oppenheimer', year: '2023', desc: 'The story of J. Robert Oppenheimer and the development of the first nuclear weapon.', rating: 'R', score: '8.3', img: 'https://images.unsplash.com/photo-1534131707746-25d604851a1f?w=1920&h=1080&fit=crop' },
    { id: '298618', type: 'movie', title: 'The Flash', year: '2023', desc: 'Barry Allen uses his super speed to change the past, but his attempt to save his family creates a world without superheroes.', rating: 'PG-13', score: '6.8', img: 'https://images.unsplash.com/photo-1440404653325-ab127d49abc1?w=1920&h=1080&fit=crop' },
    { id: '1396', type: 'tv', title: 'Breaking Bad', year: '2008', desc: 'A high school chemistry teacher turned methamphetamine manufacturer navigates the criminal underworld.', rating: 'TV-MA', score: '9.5', img: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=1920&h=1080&fit=crop' },
];

function buildHero() {
    const hero = document.getElementById('hero');
    const dots = document.getElementById('heroDots');

    HERO_DATA.forEach((d, i) => {
        const slide = document.createElement('div');
        slide.className = 'hero-slide' + (i === 0 ? ' active' : '');
        slide.innerHTML = `
            <img class="hero-bg-img" src="${d.img}" alt="${d.title}" loading="${i === 0 ? 'eager' : 'lazy'}">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <div class="hero-badge">ğŸ”¥ ${i === 0 ? 'Trending Now' : 'Featured'}</div>
                <h1 class="hero-title">${d.title}</h1>
                <div class="hero-meta">
                    <span class="hero-rating">${d.score} â˜…</span>
                    <span class="tag-pill">${d.rating}</span>
                    <span>${d.year}</span>
                </div>
                <p class="hero-desc">${d.desc}</p>
                <div class="hero-actions">
                    <button class="btn-hero-play" onclick="SF.playContentById('${d.id}','${d.type}','${d.title}','${d.year}')">
                        <span>â–¶</span> Watch Now
                    </button>
                    <button class="btn-hero-more">â„¹ More Info</button>
                </div>
            </div>`;
        hero.insertBefore(slide, hero.querySelector('#heroProgress'));

        const dot = document.createElement('div');
        dot.className = 'hero-dot' + (i === 0 ? ' active' : '');
        dot.onclick = () => goToSlide(i);
        dots.appendChild(dot);
    });

    state.heroSlides = hero.querySelectorAll('.hero-slide');
    startHeroAuto();
}

function goToSlide(idx) {
    state.heroSlides[state.heroIndex].classList.remove('active');
    document.querySelectorAll('.hero-dot')[state.heroIndex].classList.remove('active');
    state.heroIndex = idx;
    state.heroSlides[idx].classList.add('active');
    document.querySelectorAll('.hero-dot')[idx].classList.add('active');
    resetHeroProgress();
}

function startHeroAuto() {
    clearInterval(state.heroTimer);
    state.heroTimer = setInterval(() => {
        const next = (state.heroIndex + 1) % HERO_DATA.length;
        goToSlide(next);
    }, state.HERO_INTERVAL);
    resetHeroProgress();
}

function resetHeroProgress() {
    clearInterval(state.heroProgressTimer);
    state.heroProgressVal = 0;
    const bar = document.getElementById('heroProgress');
    if (!bar) return;
    bar.style.transition = 'none';
    bar.style.width = '0%';
    requestAnimationFrame(() => {
        bar.style.transition = `width ${state.HERO_INTERVAL}ms linear`;
        bar.style.width = '100%';
    });
}

/* â”€â”€ SCROLL ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function scrollRow(cat, dir) {
    const el = document.getElementById(`${cat}Content`) ||
               document.getElementById(`row-${cat}`)?.querySelector('.row-scroll');
    if (!el) return;
    const target = el.closest('.row-scroll') || el;
    target.scrollBy({ left: dir * 600, behavior: 'smooth' });
}

/* â”€â”€ SECTION REVEAL (IntersectionObserver) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function observeSections() {
    const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
            if (e.isIntersecting) {
                e.target.classList.add('visible');
                io.unobserve(e.target);
            }
        });
    }, { threshold: 0.08 });
    document.querySelectorAll('.content-section').forEach(s => io.observe(s));
}

/* â”€â”€ NAV SCROLL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initNavScroll() {
    let ticking = false;
    window.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(() => {
                document.getElementById('navbar').classList.toggle('solid', window.scrollY > 50);
                ticking = false;
            });
            ticking = true;
        }
    }, { passive: true });
}

/* â”€â”€ CARD FACTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function makeCard(item, opts = {}) {
    const img = item.poster_path
        ? `https://image.tmdb.org/t/p/w342${item.poster_path}`
        : `https://via.placeholder.com/342x513/161616/444?text=${encodeURIComponent(item.title || item.name || '?')}`;

    const title = item.title || item.name || 'Unknown';
    const year = (item.release_date || item.first_air_date || '').slice(0, 4);
    const score = item.vote_average ? item.vote_average.toFixed(1) : 'â€”';
    const type = item.media_type || opts.type || (item.title ? 'movie' : 'tv');
    const isMature = opts.mature || false;

    const card = document.createElement('div');
    card.className = 'content-card';
    card.style.animationDelay = `${(opts.idx || 0) * 55}ms`;

    card.innerHTML = `
        <div class="card-img-wrap">
            <div class="card-shimmer" id="shimmer-${item.id}"></div>
            <img class="card-img" data-src="${img}" alt="${title}" loading="lazy" style="display:none;">
            <div class="card-play-icon">â–¶</div>
            <div class="card-badge-type">${type === 'movie' ? 'FILM' : 'TV'}</div>
            ${isMature ? '<div class="card-mature-lock"><div class="lock-icon">ğŸ”’</div><div class="lock-text">18+<br>Tap to unlock</div></div>' : ''}
        </div>
        <div class="card-overlay">
            <div class="card-title">${title}</div>
            <div class="card-meta-row">
                <span class="star">â˜…</span><span>${score}</span>
                ${year ? `<span>${year}</span>` : ''}
            </div>
        </div>`;

    // Lazy load image
    const imgEl = card.querySelector('.card-img');
    const shimmer = card.querySelector('.card-shimmer');
    const lazyObs = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
            imgEl.src = imgEl.dataset.src;
            imgEl.onload = () => {
                imgEl.style.display = 'block';
                shimmer.style.display = 'none';
            };
            lazyObs.disconnect();
        }
    }, { rootMargin: '200px' });
    lazyObs.observe(card);

    if (isMature) {
        const lock = card.querySelector('.card-mature-lock');
        lock?.addEventListener('click', (e) => {
            e.stopPropagation();
            openMature();
        });
    } else {
        card.addEventListener('click', () => {
            if (typeof playContentById === 'function') {
                playContentById(String(item.id), type, title, year);
            } else {
                SF.playContentById(String(item.id), type, title, year);
            }
        });
    }

    return card;
}

/* â”€â”€ RENDER ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderRow(containerId, items, opts = {}) {
    const el = document.getElementById(containerId);
    if (!el) return;
    el.innerHTML = '';
    items.forEach((item, i) => {
        el.appendChild(makeCard(item, { ...opts, idx: i }));
    });
}

/* â”€â”€ CATEGORY LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loadCategory(cat) {
    state.currentCategory = cat;
    updateNavActive(cat);
    // Delegate to existing app.js function if available
    if (typeof window.loadCategory === 'function') {
        window.loadCategory(cat);
        return;
    }
    // Fallback: show the section
    hideSearch();
    document.getElementById('mainContent').style.display = '';
    const section = document.getElementById(`section-${cat}`);
    if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function updateNavActive(cat) {
    document.querySelectorAll('.nav-links a').forEach(a => {
        a.classList.toggle('active', a.dataset.cat === cat);
    });
}

/* â”€â”€ GENRE FILTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function filterGenre(chip) {
    document.querySelectorAll('.genre-chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    state.currentGenre = chip.dataset.genre;
    if (typeof window.filterByGenre === 'function') {
        window.filterByGenre(state.currentGenre);
    }
}

/* â”€â”€ ADVANCED FILTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function applyFilters() {
    state.filters.rating = document.getElementById('filterRating')?.value || '';
    state.filters.year   = document.getElementById('filterYear')?.value   || '';
    state.filters.lang   = document.getElementById('filterLang')?.value   || '';
    if (typeof window.applyAdvancedFilters === 'function') {
        window.applyAdvancedFilters(state.filters);
    }
}

/* â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let searchDebounce = null;
function performSearch() {
    const q = document.getElementById('searchInput')?.value.trim();
    if (!q) return;
    state.searchQuery = q;
    if (typeof window.performMainSearch === 'function') {
        window.performMainSearch();
    }
}

function hideSearch() {
    document.getElementById('searchResultsContainer').style.display = 'none';
    document.getElementById('searchInfo').classList.remove('active');
    document.getElementById('mainContent').style.display = '';
    document.getElementById('hero').style.display = '';
    document.getElementById('genreBar').style.display = '';
}

/* â”€â”€ PLAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function playContentById(id, type, title, year) {
    if (typeof window.playContentById === 'function') {
        window.playContentById(id, type, title, year);
    }
}

function closePlayer() {
    document.getElementById('playerModal').classList.remove('active');
    document.getElementById('playerVideo').innerHTML =
        '<div class="loading"><div class="spinner"></div><span>Loading player...</span></div>';
    if (typeof window.closePlayer === 'function') window.closePlayer();
}

/* â”€â”€ SEE ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function seeAll(cat) {
    if (typeof window.loadCategory === 'function') {
        window.loadCategory(cat);
    } else {
        loadCategory(cat);
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* â”€â”€ 18+ SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openMature() {
    if (isMatureUnlocked()) {
        showMatureSection();
        return;
    }
    showVerifyModal();
}

function isMatureUnlocked() {
    return state.matureUnlocked && Date.now() < state.matureSessionExpiry;
}

function showVerifyModal() {
    document.getElementById('verifyModal').style.display = 'flex';
    showAgeStep();
}

function closeVerify() {
    document.getElementById('verifyModal').style.display = 'none';
    clearPinInputs();
    document.getElementById('pinError').textContent = '';
}

function showAgeStep() {
    document.getElementById('verifyStep1').classList.add('active');
    document.getElementById('verifyStep2').classList.remove('active');
}

function showPinStep() {
    document.getElementById('verifyStep1').classList.remove('active');
    document.getElementById('verifyStep2').classList.add('active');
    setTimeout(() => document.querySelector('.pin-digit')?.focus(), 100);
}

function verifyAge() {
    grantMatureAccess();
    closeVerify();
    showMatureSection();
}

function verifyPin() {
    const now = Date.now();
    if (now < state.pinLockoutUntil) {
        const secs = Math.ceil((state.pinLockoutUntil - now) / 1000);
        document.getElementById('lockoutTimer').textContent = `Too many attempts. Try again in ${secs}s.`;
        return;
    }

    const digits = [...document.querySelectorAll('.pin-digit')].map(i => i.value);
    const pin = digits.join('');

    if (pin.length < 4) {
        document.getElementById('pinError').textContent = 'Please enter all 4 digits.';
        return;
    }

    hashPin(pin).then(hash => {
        // Default PIN 1234 hash check or stored hash
        const storedHash = localStorage.getItem('sf_pin_hash');
        if (!storedHash) {
            // First time: accept any 4-digit PIN and save
            localStorage.setItem('sf_pin_hash', hash);
            state.pinHash = hash;
            state.pinFailCount = 0;
            grantMatureAccess();
            closeVerify();
            showMatureSection();
            return;
        }
        if (hash === storedHash) {
            state.pinFailCount = 0;
            grantMatureAccess();
            closeVerify();
            showMatureSection();
        } else {
            state.pinFailCount++;
            if (state.pinFailCount >= PIN_MAX_ATTEMPTS) {
                state.pinLockoutUntil = Date.now() + PIN_LOCKOUT_MS;
                state.pinFailCount = 0;
                document.getElementById('lockoutTimer').textContent = 'Locked for 5 minutes.';
                document.getElementById('pinError').textContent = '';
            } else {
                document.getElementById('pinError').textContent = `Incorrect PIN. ${PIN_MAX_ATTEMPTS - state.pinFailCount} attempts left.`;
            }
            clearPinInputs();
        }
    });
}

async function hashPin(pin) {
    const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pin));
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

function clearPinInputs() {
    document.querySelectorAll('.pin-digit').forEach(i => i.value = '');
    document.querySelector('.pin-digit')?.focus();
}

function grantMatureAccess() {
    state.matureUnlocked = true;
    state.matureSessionExpiry = Date.now() + MATURE_SESSION_MS;
    // Auto-expire
    setTimeout(() => {
        state.matureUnlocked = false;
        document.getElementById('section-mature').style.display = 'none';
    }, MATURE_SESSION_MS);
}

function showMatureSection() {
    const sec = document.getElementById('section-mature');
    sec.style.display = '';
    sec.scrollIntoView({ behavior: 'smooth', block: 'start' });
    // Load mature content if not loaded
    const container = document.getElementById('matureContent');
    if (container && container.children.length === 0) {
        loadMatureContent();
    }
}

function loadMatureContent() {
    // Placeholder: fetch R-rated movies if API key available, else stub
    if (typeof window.loadMatureCategory === 'function') {
        window.loadMatureCategory();
    }
}

/* â”€â”€ PIN AUTO-FOCUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initPinInputs() {
    const digits = document.querySelectorAll('.pin-digit');
    digits.forEach((inp, i) => {
        inp.addEventListener('input', () => {
            inp.value = inp.value.replace(/\D/g, '').slice(-1);
            if (inp.value && i < digits.length - 1) digits[i + 1].focus();
        });
        inp.addEventListener('keydown', e => {
            if (e.key === 'Backspace' && !inp.value && i > 0) digits[i - 1].focus();
            if (e.key === 'Enter') verifyPin();
        });
    });
}

/* â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleMobileSearch() {
    const el = document.getElementById('mobileSearchOverlay');
    el.classList.add('open');
    document.getElementById('mobileSearchInput')?.focus();
}

function closeMobileSearch() {
    document.getElementById('mobileSearchOverlay').classList.remove('open');
}

function setBnActive(id) {
    document.querySelectorAll('.bn-item, .bn-search-toggle').forEach(el => el.classList.remove('active'));
    document.getElementById('bn-' + id)?.classList.add('active');
}

function goHome() {
    hideSearch();
    state.currentCategory = 'home';
    state.currentGenre = 'all';
    document.querySelectorAll('.genre-chip').forEach(c => c.classList.toggle('active', c.dataset.genre === 'all'));
    updateNavActive('home');
    window.scrollTo({ top: 0, behavior: 'smooth' });
    if (typeof window.goHome === 'function') window.goHome();
}

function showCategories() {
    // Scroll to genre bar
    document.getElementById('genreBar')?.scrollIntoView({ behavior: 'smooth' });
}

function openSettings() {
    alert('Settings â€” PIN management, display preferences, and parental controls coming soon.');
}

/* â”€â”€ INSTALL PWA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initInstall() {
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e => {
        e.preventDefault();
        deferredPrompt = e;
        const banner = document.getElementById('installBanner');
        if (banner && !localStorage.getItem('sf_install_dismissed')) {
            banner.classList.add('show');
        }
    });
    document.getElementById('installBtn')?.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const result = await deferredPrompt.userChoice;
        if (result.outcome === 'accepted') {
            document.getElementById('installBanner').classList.remove('show');
        }
        deferredPrompt = null;
    });
    document.getElementById('closeBanner')?.addEventListener('click', () => {
        document.getElementById('installBanner').classList.remove('show');
        localStorage.setItem('sf_install_dismissed', '1');
    });
}

/* â”€â”€ MOBILE SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initMobileSearch() {
    const input = document.getElementById('mobileSearchInput');
    if (!input) return;
    let t;
    input.addEventListener('input', () => {
        clearTimeout(t);
        t = setTimeout(() => {
            const q = input.value.trim();
            if (q.length > 1) {
                document.getElementById('searchInput').value = q;
                performSearch();
                closeMobileSearch();
            }
        }, 500);
    });
}

/* â”€â”€ SEARCH ENTER KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initSearchKey() {
    document.getElementById('searchInput')?.addEventListener('keydown', e => {
        if (e.key === 'Enter') performSearch();
    });
}

/* â”€â”€ WHEEL HORIZONTAL SCROLL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initWheelScroll() {
    document.querySelectorAll('.row-scroll').forEach(row => {
        row.addEventListener('wheel', e => {
            if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) return;
            e.preventDefault();
            row.scrollBy({ left: e.deltaY * 3, behavior: 'smooth' });
        }, { passive: false });
    });
}

/* â”€â”€ CONTEXT MENU DETER (soft) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initContextDeter() {
    document.addEventListener('contextmenu', e => {
        if (e.target.closest('.player-video, .card-img-wrap')) {
            e.preventDefault();
        }
    });
}

/* â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function init() {
    buildHero();
    observeSections();
    initNavScroll();
    initPinInputs();
    initInstall();
    initMobileSearch();
    initSearchKey();
    initContextDeter();

    // Defer wheel scroll after row content is populated
    setTimeout(initWheelScroll, 2000);
}

document.addEventListener('DOMContentLoaded', () => {
    init();
    if (typeof initFirebase === 'function') initFirebase();
});

return {
    goHome, loadCategory, seeAll, scrollRow, filterGenre, applyFilters,
    performSearch, playContentById, closePlayer,
    openMature, showVerifyModal, closeVerify, showAgeStep, showPinStep,
    verifyAge, verifyPin, makeCard, renderRow,
    toggleMobileSearch, closeMobileSearch, setBnActive, showCategories, openSettings,
};

})(); // end SF

// â”€â”€ Expose helpers app.js may call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.SF = SF;
</script>
</body>
</html>
